# –ü–ª–∞–Ω: GatekeeperVPN macOS GUI

## –û–±–∑–æ—Ä

–ù–∞—Ç–∏–≤–Ω–æ–µ macOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º. –ò–∫–æ–Ω–∫–∞ –≤ –º–µ–Ω—é-–±–∞—Ä–µ, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: Network Extension (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    macOS App                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   SwiftUI GUI   ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  Network Extension (Swift)  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  (Menu Bar App) ‚îÇ    ‚îÇ  PacketTunnelProvider       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                      ‚îÇ                   ‚îÇ
‚îÇ                                      ‚ñº                   ‚îÇ
‚îÇ                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ                         ‚îÇ  GatekeeperCore (Rust‚ÜíC)    ‚îÇ ‚îÇ
‚îÇ                         ‚îÇ  - Handshake                ‚îÇ ‚îÇ
‚îÇ                         ‚îÇ  - Encryption               ‚îÇ ‚îÇ
‚îÇ                         ‚îÇ  - Protocol                 ‚îÇ ‚îÇ
‚îÇ                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–ª—é—Å—ã:**
- –ù–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å macOS VPN
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ –±–µ–∑ root
- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏

**–ú–∏–Ω—É—Å—ã:**
- –¢—Ä–µ–±—É–µ—Ç Apple Developer Account ($99/–≥–æ–¥)
- –°–ª–æ–∂–Ω–µ–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- –ù—É–∂–Ω–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å–∫ CLI –∫–∞–∫ subprocess

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    macOS App                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                    ‚îÇ
‚îÇ  ‚îÇ   SwiftUI GUI   ‚îÇ                                    ‚îÇ
‚îÇ  ‚îÇ  (Menu Bar App) ‚îÇ                                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                    ‚îÇ
‚îÇ           ‚îÇ Process.launch()                            ‚îÇ
‚îÇ           ‚ñº                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ  gatekeeper-client (Rust binary)                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ  –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å sudo —á–µ—Ä–µ–∑ osascript                 ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–ª—é—Å—ã:**
- –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ù–µ –Ω—É–∂–µ–Ω Developer Account –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

**–ú–∏–Ω—É—Å—ã:**
- –¢—Ä–µ–±—É–µ—Ç sudo (–∑–∞–ø—Ä–æ—Å –ø–∞—Ä–æ–ª—è)
- –ú–µ–Ω–µ–µ "–Ω–∞—Ç–∏–≤–Ω–æ"
- –°–ª–æ–∂–Ω–µ–µ —É–ø—Ä–∞–≤–ª—è—Ç—å lifecycle

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ù–∞—á–∞—Ç—å —Å –í–∞—Ä–∏–∞–Ω—Ç–∞ 2** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞, –∑–∞—Ç–µ–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ **–í–∞—Ä–∏–∞–Ω—Ç 1** –¥–ª—è production.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
GatekeeperVPN-macOS/
‚îú‚îÄ‚îÄ GatekeeperVPN/
‚îÇ   ‚îú‚îÄ‚îÄ App/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GatekeeperVPNApp.swift      # Entry point
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AppDelegate.swift           # Menu bar setup
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Views/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MenuBarView.swift           # Popup menu content
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StatusView.swift            # Connection status
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfilesView.swift          # List of profiles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SettingsView.swift          # App settings
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Components/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ StatusIndicator.swift   # Green/red dot
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ProfileRow.swift        # Single profile item
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ ViewModels/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VPNManager.swift            # Main VPN logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfileManager.swift        # Profile CRUD
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ConnectionState.swift       # State machine
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Profile.swift               # VPN profile model
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConnectionStatus.swift      # Enum: connected/disconnected/...
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ServerInfo.swift            # Server details
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VPNService.swift            # Interface to VPN
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProcessRunner.swift         # Run CLI commands
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConfigParser.swift          # Parse .conf files
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ KeychainService.swift       # Secure storage
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Resources/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Assets.xcassets/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppIcon.appiconset/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MenuBarIcon.imageset/   # Status icons
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Colors.colorset/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Localizable.strings
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ Info.plist
‚îÇ
‚îú‚îÄ‚îÄ GatekeeperVPNTests/
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ Binaries/                           # Embedded Rust binaries
‚îÇ   ‚îî‚îÄ‚îÄ gatekeeper-client              # Pre-built for macOS
‚îÇ
‚îî‚îÄ‚îÄ GatekeeperVPN.xcodeproj
```

---

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### MVP (–§–∞–∑–∞ 1)

#### Menu Bar

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üü¢ Connected                ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ üìç 10.10.10.2               ‚îÇ
‚îÇ üåê vpn.example.com          ‚îÇ
‚îÇ ‚è±  00:45:23                 ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ ‚è∏  Disconnect               ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ üìã Profiles                 ‚îÇ
‚îÇ    ‚îú‚îÄ üè† Home Server    ‚úì   ‚îÇ
‚îÇ    ‚îú‚îÄ üè¢ Work Server        ‚îÇ
‚îÇ    ‚îî‚îÄ + Add Profile...      ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ ‚öôÔ∏è  Settings...             ‚îÇ
‚îÇ ‚ùì About                    ‚îÇ
‚îÇ ‚èª  Quit                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```swift
enum ConnectionStatus {
    case disconnected           // üî¥ –°–µ—Ä—ã–π/–∫—Ä–∞—Å–Ω—ã–π
    case connecting             // üü° –ñ—ë–ª—Ç—ã–π, –∞–Ω–∏–º–∞—Ü–∏—è
    case connected(since: Date) // üü¢ –ó–µ–ª—ë–Ω—ã–π
    case reconnecting           // üü° –ñ—ë–ª—Ç—ã–π
    case error(String)          // üî¥ –ö—Ä–∞—Å–Ω—ã–π + —Å–æ–æ–±—â–µ–Ω–∏–µ
}
```

#### –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ** –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º
2. **–í—ã–±–æ—Ä –ø—Ä–æ—Ñ–∏–ª—è** –∏–∑ —Å–ø–∏—Å–∫–∞
3. **–ò–º–ø–æ—Ä—Ç –ø—Ä–æ—Ñ–∏–ª—è** –∏–∑ .conf —Ñ–∞–π–ª–∞
4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
5. **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫** –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏—è

1. **QR-–∫–æ–¥ —Å–∫–∞–Ω–µ—Ä** –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π
2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏/–æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** —Ç—Ä–∞—Ñ–∏–∫–∞ (bytes in/out)
4. **–õ–æ–≥–∏** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
5. **–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –§–∞–∑–∞ 3: Network Extension

1. –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PacketTunnelProvider
2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ VPN
3. On-demand VPN (–∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Å–µ—Ç—è—Ö)

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| UI Framework | SwiftUI |
| –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è macOS | 13.0 (Ventura) |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | MVVM |
| –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ | Keychain |
| –•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ | UserDefaults / @AppStorage |
| –ó–∞–ø—É—Å–∫ CLI | Process (Foundation) |
| IPC (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω) | XPC Services |

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Rust

### –í–∞—Ä–∏–∞–Ω—Ç A: –ó–∞–ø—É—Å–∫ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ (MVP)

```swift
class VPNService {
    private var process: Process?

    func connect(profile: Profile) async throws {
        let configPath = saveConfigToTemp(profile)

        // –ó–∞–ø—É—Å–∫ —Å sudo —á–µ—Ä–µ–∑ AppleScript
        let script = """
            do shell script "\(binaryPath) -c \(configPath)" \\
                with administrator privileges
        """

        process = Process()
        process?.executableURL = URL(fileURLWithPath: "/usr/bin/osascript")
        process?.arguments = ["-e", script]

        try process?.run()
    }

    func disconnect() {
        process?.terminate()
    }
}
```

### –í–∞—Ä–∏–∞–Ω—Ç B: FFI —á–µ—Ä–µ–∑ C (Production)

```rust
// gatekeeper-ffi/src/lib.rs
#[no_mangle]
pub extern "C" fn gk_connect(config_json: *const c_char) -> i32 { ... }

#[no_mangle]
pub extern "C" fn gk_disconnect() -> i32 { ... }

#[no_mangle]
pub extern "C" fn gk_get_status() -> *mut c_char { ... }
```

```swift
// Swift bridging header
func gk_connect(_ config: UnsafePointer<CChar>) -> Int32
func gk_disconnect() -> Int32
func gk_get_status() -> UnsafeMutablePointer<CChar>
```

---

## UI/UX –¥–∏–∑–∞–π–Ω

### –ò–∫–æ–Ω–∫–∏ Menu Bar

```
Disconnected:  ‚óã  (—Å–µ—Ä—ã–π outline)
Connecting:    ‚óê  (–∞–Ω–∏–º–∞—Ü–∏—è)
Connected:     ‚óè  (–∑–∞–ª–∏—Ç—ã–π —Ü–≤–µ—Ç –∞–∫—Ü–µ–Ω—Ç–∞)
Error:         ‚äó  (–∫—Ä–∞—Å–Ω—ã–π)
```

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

- –°–ª–µ–¥–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º–µ (Light/Dark)
- –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç: —Å–∏—Å—Ç–µ–º–Ω—ã–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
- –°—Ç–∞—Ç—É—Å—ã:
  - –ó–µ–ª—ë–Ω—ã–π: #34C759 (system green)
  - –ñ—ë–ª—Ç—ã–π: #FFCC00 (system yellow)
  - –ö—Ä–∞—Å–Ω—ã–π: #FF3B30 (system red)

### –†–∞–∑–º–µ—Ä—ã

- Menu bar popup: 280pt —à–∏—Ä–∏–Ω–∞
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞: 200pt
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞: 400pt (—Å–æ —Å–∫—Ä–æ–ª–ª–æ–º)

---

## –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### Keychain (—Å–µ–∫—Ä–µ—Ç—ã)

```swift
struct KeychainService {
    func savePrivateKey(_ key: String, for profile: String) throws
    func getPrivateKey(for profile: String) throws -> String
    func deletePrivateKey(for profile: String) throws
}
```

### UserDefaults (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

```swift
@AppStorage("launchAtLogin") var launchAtLogin = false
@AppStorage("showInDock") var showInDock = false
@AppStorage("lastProfileId") var lastProfileId: String?
@AppStorage("autoConnect") var autoConnect = false
```

### File System (–ø—Ä–æ—Ñ–∏–ª–∏)

```
~/Library/Application Support/GatekeeperVPN/
‚îú‚îÄ‚îÄ profiles/
‚îÇ   ‚îú‚îÄ‚îÄ home-server.json
‚îÇ   ‚îî‚îÄ‚îÄ work-server.json
‚îî‚îÄ‚îÄ logs/
    ‚îî‚îÄ‚îÄ vpn.log
```

---

## –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°–∫–µ–ª–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (2-3 –¥–Ω—è)

1. –°–æ–∑–¥–∞—Ç—å Xcode –ø—Ä–æ–µ–∫—Ç (SwiftUI, Menu Bar App)
2. –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫
3. Menu bar –∏–∫–æ–Ω–∫–∞ –∏ popup
4. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π UI –±–µ–∑ –ª–æ–≥–∏–∫–∏

### –≠—Ç–∞–ø 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ (2-3 –¥–Ω—è)

1. –ú–æ–¥–µ–ª—å Profile
2. –ò–º–ø–æ—Ä—Ç .conf —Ñ–∞–π–ª–∞
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
4. –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ Keychain
5. –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ UI

### –≠—Ç–∞–ø 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (3-4 –¥–Ω—è)

1. VPNService —Å –∑–∞–ø—É—Å–∫–æ–º CLI
2. –ü–∞—Ä—Å–∏–Ω–≥ stdout –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –≠—Ç–∞–ø 4: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (2-3 –¥–Ω—è)

1. –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
3. About –æ–∫–Ω–æ
4. –ò–∫–æ–Ω–∫–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏–∏
5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠—Ç–∞–ø 5: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–µ–ª–∏–∑—É (2-3 –¥–Ω—è)

1. Code signing
2. Notarization
3. DMG installer
4. README –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- macOS 13+ (Ventura)
- Xcode 15+
- Swift 5.9+
- Apple Developer Account (–¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∏ Network Extension)

---

## –†–∏—Å–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

| –†–∏—Å–∫ | –†–µ—à–µ–Ω–∏–µ |
|------|---------|
| Sudo —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–æ–ª—å | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Keychain, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Security framework |
| CLI –ø–∞–¥–∞–µ—Ç | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞, –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ |
| Network Extension —Å–ª–æ–∂–µ–Ω | –ù–∞—á–∞—Ç—å —Å –ø—Ä–æ—Å—Ç–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞, –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ |
| –ù–µ—Ç Developer Account | –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –±–µ–∑ –Ω–µ–≥–æ, –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω—É–∂–µ–Ω |

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

### Electron / Tauri

- ‚ùå –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä (Electron)
- ‚ùå –ù–µ –Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∏–¥
- ‚úÖ –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å

### Qt / GTK

- ‚ùå –ù–µ –Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∏–¥ –Ω–∞ macOS
- ‚ùå –°–ª–æ–∂–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π

### –†–µ—à–µ–Ω–∏–µ: SwiftUI ‚Äî –ª—É—á—à–∏–π –≤—ã–±–æ—Ä –¥–ª—è macOS-only –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
